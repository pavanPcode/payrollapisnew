/****** Object:  Table [dbo].[ScreenOperations]    Script Date: 03/01/2026 12:22:18 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ScreenOperations](
	[Id] [int] NOT NULL,
	[TableName] [varchar](50) NOT NULL,
	[OpText] [varchar](15) NOT NULL,
	[SQLQuery] [varchar](max) NULL,
	[IsActive] [bit] NOT NULL,
 CONSTRAINT [PK_ScreenOperations] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (1, N'PROD.func_getNextSwipeType', N'getPunchType', N'select PROD.func_getNextSwipeType(@regid) as PunchType', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (2, N'[PROD].[MyRollCallUsers]', N'SignIn', N'select * from [PROD].[MyRollCallUsers] Where Badge = ''@username'' AND
		   password = ''@password''', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (3, N'[PROD].[MyRollCallUsers]', N'changepassword', N'IF EXISTS (
    SELECT 1 
    FROM [PROD].[MyRollCallUsers] 
    WHERE SuperId = @SuperId AND RegId = @RegId AND password = ''@oldpwd'' AND Badge = ''@username''
)
BEGIN
    UPDATE [PROD].[MyRollCallUsers]
    SET password = @newpwd
    WHERE SuperId = @SuperId AND RegId = @RegId AND password =''@oldpwd'' AND Badge = ''@username'';

    SELECT ''Password updated successfully'' AS Message;
END
ELSE
BEGIN
    SELECT ''Old password does not match'' AS Message;
END', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (4, N'Prod.LeaveTypes', N'getleavetype', N'select * from  Prod.LeaveTypes ', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (5, N'prod.V_Leaves', N'getempleaves', N'SELECT * FROM prod.V_Leaves     WHERE  superid = @superid and  RegId = @regid  AND    
StartDt >= ''@StartDt''  AND EndDt <= ''@EndDt''     order by StartDt desc', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (6, N'PROD.Leaves', N'saveleave', N'
EXEC PROD.SP_InsertLeave @superid, @regid, @lvtypeid, @halfday, ''@startdate'', ''@enddate'',@leavecount,''@comments'',1

insert into [PROD].[Notification](superid,name,description,isactive,regid,type)
values(@superid,''Leave'',''Leave request created succesfully'',1,@regid,1)

insert into [PROD].[Notification](superid,name,description,isactive,regid,type)
values(@superid,''Leave'','' leave application has been received.'',1,(select managerid from  [PROD].[EmpManager] where regid =@regid),1)', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (7, N' Prod.V_DayInOutDetails ', N'getlast7dayAtt', N'Select CardId as [BioMetricId],UserName as [Employee],Designation,Dept as [Dept],
ActualShiftName as [ActualShift],  CONVERT(varchar(10),DateOfTransaction,103)as [Date],  InStCode as [Status],InTime as [InTime],
OutTime as [OutTime],Duration from Prod.V_DayInOutDetails 
Where SuperId =@superid and RegId = @regid and DateOfTransaction between ''@fromdate'' and ''@todate''
order by Date desc', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (8, N' Prod.V_DayInOutDetails ', N'getattendance', N'Select CardId as [BioMetricId],UserName as [Employee],Designation,Dept as [Dept],
ActualShiftName as [ActualShift],  CONVERT(varchar(10),DateOfTransaction,103)as [Date],  InStCode as [Status],InTime as [InTime],
OutTime as [OutTime],Duration from Prod.V_DayInOutDetails 
Where SuperId =@superid and RegId = @regid and DateOfTransaction between ''@fromdate'' and ''@todate''
order by Date desc', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (9, N'PROD.SP_NonDeviceSwipe', N'writeswipe', N'EXEC PROD.SP_NonDeviceSwipe @superid,@regid,''@dateoftransaction'',       ''@Latitude'',''@Longitude'',''@address''', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (10, N'Prod.Registration', N'getempprofile', N'Select r.id RegId,r.*,[PROD].[func_IsEmplManager](@regid) as IsManager,rd.EmailId,rd.CurrentAddress from Prod.Registration r 
left join [PROD].[RegDetails] rd on r.id = rd.RegId
Where r.Id = @regid and r.IsActive = 1', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (11, N'[PROD].[Holidays]', N'getholidays', N'
select id holidayid,SuperId, HolidayDt, UpdatedBy, UpdatedOn, Reason, Optional,isactive from [PROD].[Holidays]   
where superid = @superid and HolidayDt between ''@startdate'' and ''@enddate''   order by HolidayDt', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (12, N'Prod.V_LeaveAccruals', N'getaccruals', N'Select LeaveTypeName,CarryForwardLeaves,Accrued,Taken,Balance,
(select count (*) APPROVED from [PROD].[Leaves] where Status = 2 and RegId = @regid) ''approved'' ,
(select count (*) PENDING from [PROD].[Leaves] where Status = 1 and RegId = @regid) ''pending'',
(select count (*) REJECTED from [PROD].[Leaves] where Status = 3 and RegId = @regid) ''cancelled''  
 from Prod.V_LeaveAccruals Where RegId = @regid and Year =@year', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (13, N'Prod.V_LeaveAccruals', N'getleavesummary', N'select * from prod.V_LeaveAccruals where year = @year and regid = @regid and isactive = 1', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (14, N'[PROD].[EmpManager]', N'addteammember', N'IF NOT EXISTS (SELECT 1 FROM [PROD].[EmpManager] WHERE regid = @regid and isactive = 1)
BEGIN
    INSERT INTO [PROD].[EmpManager] (superid, regid, ManagerId)
    VALUES (@superid, @regid, @managerid)
END
ELSE
BEGIN
    select 0 type , ''Emp already in a team'' message
END', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (15, N'[PROD].[EmpManager]', N'delteammember', N'update [PROD].[EmpManager] set isactive = 0 where regid = @regid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (16, N'[PROD].[Registration]', N'getemployees', N'SELECT RegId,SuperId,Badge,UserName,DateOfBirth,Designation,CardId,Mobile,RFID,DateOfJoining,  DateOfRegistration,Gender,BranchId,BranchName,BranchCode,  DepartmentId,DepartmentName,DepartmentCode,ShiftId,ShiftName  FROM [PROD].[VW_Registration]  WHERE SuperId = @SuperId    AND IsActive = 1  ORDER BY RegId DESC;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (17, N'[PROD].V_ManagerLeaves', N'getteamleaves', N'Select * from Prod.V_ManagerLeaves Where ManagerId=@managerid and RegId = @regid and status = @status
and Year(StartDt)=@year and isactive = 1  order by StartDt desc', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (18, N'V_DayInOutDetailsEMPManager', N'teamattendance', N'Select * from Prod.V_DayInOutDetailsEMPManager Where ManagerId = @managerid and RegId = @regid  
and (DateOfTransaction >=   ''@startdate'' and DateOfTransaction <= ''@enddate'')  
order by DateOfTransaction ,InTime desc', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (19, N'V_ManagerEmployes', N'getmyteam', N'Select * from Prod.V_ManagerEmployes Where ManagerId = @managerid and isactive = 1', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (20, N'RequestPasses', N'requestPass', N'

EXEC InsertRequestPassesAndVisitors
     @RegId,''@RelType'', ''@VisitorName'', ''@PhoneNumber'', ''@Email'',
     ''@VehicleInfo'', ''@NoOfMembers'', ''@ReturnableMaterial'', ''@Remarks'',
     ''@SuperId'', ''@Date'', ''@Status'',
     ''@CreatedBy'', ''@visitors'';', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (21, N'RequestPasses', N'getVisitingPass', N'select * from [dbo].[RequestPasses] where RegId = @regid order by id desc', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (22, N'AttendeesDetails', N'getAttDetails', N'select * from dbo.[AttendeesDetails] where requestid = @passid  and isactive = 1', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (23, N'RequestPasses', N'updatePass', N'UPDATE [dbo].[RequestPasses]
SET 
    [RelType] = ''@RelType'',
    [VisitorName] = ''@VisitorName'',
    [PhoneNumber] = ''@PhoneNumber'',
    [Email] = ''@Email'',
    [VehicleInfo] = ''@VehicleInfo'',
    [NoOfMembers] = ''@NoOfMembers'',
    [ReturnableMaterial] = ''@ReturnableMaterial'',
    [Remarks] = ''@Remarks'',
    [Date] = ''@Date'',
    [Status]= ''@Status'',UpdatedBy = @UpdatedBy
    WHERE 
        [id] = @id and [RegId] = @RegId', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (24, N'Notification', N'getNotifys', N'SELECT *
FROM [PROD].[Notification]
WHERE Superid = @superid
  AND IsActive = 1
  AND Regid = @regid
  AND Type = 1

UNION ALL

SELECT *
FROM [PROD].[Notification]
WHERE Superid = @superid
  AND IsActive = 1
  AND Type = 2

ORDER BY CreatedOn DESC;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (25, N'PROD.Leaves', N'updateleave', N'exec [PROD].[SP_UpdateLeaveStatus] @leaveid,@status,@regid, ''@comments'';

insert into [PROD].[Notification](superid,name,description,isactive,regid,type)
values((select superid from [PROD].[Registration] where id = @regid),''Leave'',''Leave Approved'',1,@regid,1)', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (26, N'[PROD].[Project]', N'createproject', N'INSERT INTO [PROD].[Project]([Title],[CustomerId],[StartDate],[EndDate],[Status],[ManagerId],[IsActive],[SuperId],[CreatedOn])
VALUES (''@title'',@customerid,''@startdate'',''@enddate'',@status,@managerid,1,@superid,DATEADD(MINUTE, 330, GETDATE()))', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (27, N'[PROD].[Project]', N'updateproject', N'UPDATE [PROD].[Project] SET [Title] = ''@title'',[CustomerId] = @customerid,[StartDate] = ''@startdate'',
[EndDate]= ''@enddate'',[Status] = @status,
[ManagerId] = @managerid,[SuperId] = @superid WHERE id = @projectid;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (28, N'[PROD].[Project]', N'deleteproject', N'UPDATE [PROD].[Project] SET isactive = 0 WHERE id = @projectid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (29, N'[PROD].[Project]', N'getproject', N'select p.id projectid,p.Title,p.CustomerId,p.StartDate,p.EndDate,p.Status,p.ManagerId,p.SuperId,c.name cusname ,
c.EmailId cusemailid,c.PhoneNo cusphoneno from [PROD].[Project] p 
inner join [PROD].[Customer] c on c.id = p.CustomerId where p.IsActive = 1 and ManagerId =@managerid
order by p.StartDate desc', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (30, N'[PROD].[Project]', N'getProForEmp', N'select pt.ProjectId,pt.RegId,pt.SuperId,p.Title ProjectName,p.Status,p.StartDate,p.EndDate,p.ManagerId from [PROD].[Project_Team] pt
inner join [PROD].[Project] p on p.id = pt.ProjectId
where pt.IsActive = 1 and p.IsActive = 1 and pt.RegId = @regid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (31, N'[Project_Team]', N'createproteam', N'insert into  [PROD].[Project_Team] (RegId,SuperId,ProjectId,createdby ,createdon,isactive)
values(@regid,@superid,@projectid,''@createdby'',DATEADD(MINUTE, 330, GETDATE()),1)', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (32, N'[Project_Team]', N'getproteam', N'select pt.id projectteamid,pt.ProjectId,pt.RegId,pt.SuperId,p.Title projecttitle,r.UserName username from [PROD].[Project_Team] pt  
inner join [PROD].[Project] p on p.id = pt.ProjectId 
inner join [PROD].[Registration] r on r.id = pt.RegId
where pt.ProjectId = @projectid and pt.isactive = 1', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (33, N'[Project_Team]', N'deleteproteam', N'update [PROD].[Project_Team] set isactive = 0 where id = @projectteamid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (34, N'Milestone', N'deleteproteam', N'update  [PROD].[Milestone] set isactive = 0  where id = @milestoneid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (35, N'Milestone', N'createmilestone', N'insert into [PROD].[Milestone](ProjectId,StartDate,EndDate,Description,SuperId,CreatedBy,IsActive,CreatedOn) 
values(@projectid,''@startdate'',''@enddate'',''@description'',@superid,@createdby,1,DATEADD(MINUTE, 330, GETDATE()))', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (36, N'Milestone', N'createmilestone', N'update  [PROD].[Milestone] set ProjectId = @projectid,StartDate = ''@startdate'',EndDate = ''@enddate'',
Description = ''@description'',SuperId = @superid  where id = @milestoneid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (37, N'Milestone', N'getmilestone', N'select m.id Milestoneid,m.ProjectId,m.StartDate,m.EndDate,m.Description,m.SuperId,p.Title projecttitle from [PROD].[Milestone] m 
inner join [PROD].[Project] p on p.id = m.ProjectId 
where m.projectid =@projectid and m.isactive = 1', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (38, N'[Tasks]', N'updatetask', N'update [PROD].[Tasks] set Title = ''@title'',Description =''@description'', ProjectId = @projectid,MilestoneId = @milestoneid,
StartDate = ''@startdate'',
EndDate = ''@enddate'',Priority = ''@priority'',SuperId = ''@superid'' where id = @taskid ', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (39, N'[Tasks] ', N'deletetask', N'update [PROD].[Tasks] set IsActive = 0 where id = @taskid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (40, N'[Tasks]', N'createtask', N'insert into [PROD].[Tasks](Title,Description,ProjectId,MilestoneId,StartDate,EndDate,Priority,SuperId,CreatedBy,CreatedOn,IsActive)
values(''@title'',''@description'',@projectid,@milestoneid,''@startdate'',''@enddate'',@priority,@superid,@createdby,DATEADD(MINUTE, 330, GETDATE()),1)', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (41, N'[Tasks]', N'gettask', N'select t.id taskid,t.Title,t.Description,t.ProjectId,t.MilestoneId,t.StartDate,t.EndDate,t.Priority,t.SuperId ,
p.Title projectname,p.CustomerId,
p.managerid
from [PROD].[Tasks] t
inner join [PROD].[Project]  p on p.Id = t.ProjectId
where t.isactive = 1 and t.ProjectId = @projectid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (42, N'TimeSheets', N'createtimesheet', N'insert into [PROD].[TimeSheets](taskid,date,Description,StartTime,EndTime,RegId,SuperId,CreatedBy,CreatedOn,IsActive)
values(@taskid,''@date'',''@description'',''@starttime'',''@endtime'',@regid,@superid,@createdby,DATEADD(MINUTE, 330, GETDATE()),1)', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (43, N'TimeSheets', N'updatetimesheet', N'update [PROD].[TimeSheets] set taskid = @taskid ,date =''@date'' ,Description = ''@description'',StartTime = ''@starttime'' ,
EndTime = ''@endtime'',RegId = ''@regid'',SuperId = @superid where id = @timesheetid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (44, N'[TimeSheets]', N'deletetimesheet', N'update [PROD].[TimeSheets] set isactive = 0 where id = @timesheetid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (45, N'TimeSheets', N'gettsbyuser', N'select t.id timesheetid,t.taskid,    CONVERT(varchar,CONVERT(date, t.date) , 120) AS date
,t.Description,CONVERT(varchar, t.StartTime, 120) AS StartTime,
    CONVERT(varchar, t.EndTime, 120) AS EndTime,t.RegId,t.SuperId ,tk.Title taskname,tk.ProjectId,p.Title projectname ,p.CustomerId,p.ManagerId
	from [PROD].[TimeSheets] t
	inner join [PROD].[Tasks] tk on tk.Id = t.taskid
	inner join [PROD].[Project]  p on p.Id = tk.ProjectId
	where t.TaskId = @TaskId and t.isactive = 1 order by t.date ,t.StartTime desc', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (46, N'TimeSheets', N'gettsbyuser', N'select t.id timesheetid,t.taskid,    CONVERT(varchar,CONVERT(date, t.date) , 120) AS date
,t.Description,CONVERT(varchar, t.StartTime, 120) AS StartTime,
    CONVERT(varchar, t.EndTime, 120) AS EndTime,t.RegId,t.SuperId ,tk.Title taskname,tk.ProjectId,p.Title projectname ,p.CustomerId,p.ManagerId
	from [PROD].[TimeSheets] t
	inner join [PROD].[Tasks] tk on tk.Id = t.taskid
	inner join [PROD].[Project]  p on p.Id = tk.ProjectId
	where t.regid = @regid  and t.isactive = 1 order by t.date ,t.StartTime desc', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (47, N'[Notification]', N'deletean', N'update [PROD].[Notification] set isactive = 0 where id = @notificationid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (48, N'[Notification]', N'createans', N'insert into [PROD].[Notification](superid,name,description,startdatetime,enddatetime,isread,type)  
values(@superid,''@name'',''@description'',''@startdatetime'',''@enddatetime'',0,2)', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (49, N'[Notification]', N'updateanno', N'update [PROD].[Notification] set superid = @superid,name = ''@name'',description = ''@description'',
startdatetime = ''@startdatetime'',enddatetime = ''@enddatetime'' where id = @notificationid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (50, N'[Notification]', N'updateanisread', N'update [PROD].[Notification] set isread = 1 where id = @notificationid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (51, N'[Notification]', N'getannouncemets', N'select id notificationid,superid,name,description,startdatetime,enddatetime,isread,createdon from [PROD].[Notification]  
where superid = @superid and  isactive= 1 and type = 2 order by startdatetime desc ', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (52, N'[Holidays]', N'createHolidays', N'INSERT INTO [PROD].[Holidays] (SuperId, HolidayDt, UpdatedBy, UpdatedOn, Reason, Optional)
VALUES (@superid, ''@holidaydt'', @createdby, DATEADD(MINUTE, 330, GETUTCDATE()), ''@reason'', @optional )', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (53, N'[Holidays]', N'updateholiday', N'UPDATE [PROD].[Holidays]  SET HolidayDt = ''@holidaydt'',UpdatedBy = @createdby,
  UpdatedOn =  DATEADD(MINUTE, 330, GETUTCDATE()),Reason =''@reason'',Optional = ''@optional''
   WHERE Id = @holidayid;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (54, N'[Holidays]', N'deleteholiday', N'UPDATE [PROD].[Holidays]
SET isactive = CASE 
    WHEN isactive = 1 THEN 0
    ELSE 1
END
WHERE id = @holidayid

 ', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (55, N'Department', N'createdept', N'insert into [PROD].[Department] (SuperId,name,code,IsActive)
values(@superid,''@name'',''@code'',1)', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (56, N'Department', N'updatedeptt', N'UPDATE [PROD].[Department] SET Name = ''@name'' ,Code = ''@code'' where id =  @departmentid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (57, N'Department', N'deletedept', N'UPDATE [PROD].[Department]
SET isactive = CASE 
    WHEN isactive = 1 THEN 0
    ELSE 1
END
WHERE id = @departmentid


 ', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (58, N'Department', N'getdept', N'SELECT d.Id AS DepartmentId,d.SuperId,d.Name,d.Code,COUNT(r.Id) AS EmpCount,d.IsActive
FROM [PROD].[Department] d
LEFT JOIN [PROD].[EmpDept] ed ON ed.DeptId = d.Id AND ed.IsActive = 1
LEFT JOIN [PROD].[Registration] r ON r.Id = ed.RegId AND r.IsActive = 1
WHERE d.SuperId = @SuperId
GROUP BY d.Id,d.SuperId,d.Name,d.Code,d.IsActive;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (59, N'Department', N'getEmpByDept', N'
 SELECT Id regid, UserName + ''-'' + Badge AS UserName      ,badge,Department as Departmentname,CardId,DateOfJoining,Mobile,
 Gender,DeptId,Designation,Shift as ShiftName,EmpShiftId     FROM prod.V_AllRegDetails    
 WHERE SuperId = @superid  AND DeptId = @departmentid  ORDER BY Badge;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (60, N'Registration', N'createEmp', N'DECLARE @RegId INT,@ReturnMessage NVARCHAR(500),@ReturnStatus NVARCHAR(10);
EXEC [PROD].[Sp_EmployeeRegistration] @EmployeeJson = ''@InputEmployeeJson'',@RegOutId = @RegId OUTPUT,
@ReturnMessage = @ReturnMessage OUTPUT,
@ReturnStatus = @ReturnStatus OUTPUT;
Select @RegId as RegId,@ReturnMessage as message,@ReturnStatus as status', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (61, N'Registration', N'updateEmployee', N'DECLARE @RegId INT,@ReturnMessage NVARCHAR(500),@ReturnStatus NVARCHAR(10);
EXEC [PROD].[Sp_EmployeeRegistration] @EmployeeJson = ''@InputEmployeeJson'',@RegOutId = @RegId OUTPUT,
@ReturnMessage = @ReturnMessage OUTPUT,
@ReturnStatus = @ReturnStatus OUTPUT;
Select @RegId as RegId,@ReturnMessage as message,@ReturnStatus as status', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (62, N'Registration', N'deleteEmployee', N'update [PROD].[Registration] set IsActive = 0 where id = @regid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (63, N'Registration', N'getEmployee', N'SELECT RegId,SuperId,Badge,UserName,DateOfBirth,Designation,CardId,Mobile,RFID,Gender,IsActive,DateOfJoining,
DateOfRegistration,MobileAccess,EmpPortalAccess,BranchId,BranchName,BranchCode,
DepartmentId,DepartmentName,DepartmentCode,ShiftId,ShiftName,EmailId
FROM [PROD].[VW_Registration]
WHERE SuperId = @SuperId
  AND IsActive = 1
  AND DepartmentId = @DepartmentId
  AND RegId = @RegId
ORDER BY RegId DESC;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (64, N'RegBankDetails', N'creRegBankDet', N'insert into [PROD].[RegBankDetails](SuperId,RegId,AccountNo,AccountHoldersName,BankName,BankBranch,IfscCode,createdby)
values(@superid,@regid,''@accountNo'',''@accountholdersname'',''@bankName'',''@bankbranch'',''@ifsccode'',@createdby)', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (65, N'RegBankDetails', N'updRegBankDet', N'update [PROD].[RegBankDetails] set AccountNo = ''@accountNo'' 
,AccountHoldersName =''@accountholdersname'' ,BankName = ''@bankName'',
BankBranch = ''@bankbranch'',IfscCode = ''@ifsccode'' where RegId = @regid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (66, N'RegBankDetails', N'getRegBankDet', N'select SuperId,RegId,AccountNo,AccountHoldersName,BankName,BankBranch,IfscCode 
from [PROD].[RegBankDetails]  
where regid = @regid and isactive = 1 ;  
', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (67, N'RegBankDetails', N'delRegBankDet', N'update [PROD].[RegBankDetails] set IsActive = 0 where RegId = @regid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (68, N'RegProofs', N'creRegProof', N'insert into  [PROD].[RegProofs](SuperId,regid,pan,uan,adhaar,esi,pf,EPFStart,VoterId,CreatedBy)
values(@superid,@regid,''@pan'',''@uan'',''@adhaar'',''@esi'',''@pf'',''@epfstart'',''@voterid'',@createdby)', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (69, N'RegProofs', N'upRegProof', N'update [PROD].[RegProofs] set pan = ''@pan'',uan = ''@uan'',adhaar = ''@adhaar'',esi = ''@esi'',pf = ''@pf'',
EPFStart = ''@epfstart'',
VoterId = ''@voterid'' where RegId = @regid
', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (70, N'RegProofs', N'getRegProofs', N'select SuperId,regid,pan,uan,adhaar,esi,pf,EPFStart,VoterId 
from [PROD].[RegProofs]   
where regid = @regid and isactive = 1;  
', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (71, N'RegDetails', N'creRegDet', N'insert into [PROD].[RegDetails](superid,regid,emailid,EmergencyContactNo1,EmergencyContactNo2,CurrentAddress,PermanentAddress,isactive)
values(@superid,@regid,''@emailid'',''@emergencycontactno1'',''@emergencycontactno2'',''@currentaddress'',''@permanentaddress'',1)  ', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (72, N'RegDetails', N'upRegDet', N'update [PROD].[RegDetails] set emailid = ''@emailid'',EmergencyContactNo1 = ''@emergencycontactno1''
,EmergencyContactNo2 = ''@emergencycontactno2'',
CurrentAddress = ''@currentaddress'',PermanentAddress = ''@permanentaddress'' where RegId =  @regid ', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (73, N'RegDetails', N'getRegDet', N'select superid,regid,emailid,EmergencyContactNo1,EmergencyContactNo2,CurrentAddress,PermanentAddress 
from [PROD].[RegDetails]
where IsActive = 1 and RegId = @regid;  
', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (74, N'RegFamily', N'creRegFamily', N'insert into [PROD].[RegFamily] (SuperId,RegId,Name,Relation,DateOfBirth,Age,CreatedBy,CreatedOn)
values(@SuperId,@RegId,''@Name'',''@Relation'',''@DateOfBirth'',@Age,@CreatedBy,DATEADD(MINUTE, 330, GETUTCDATE()))
 ', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (75, N'RegFamily', N'updRegFamily', N'

update [PROD].[RegFamily] set Name = ''@Name'',Relation = ''@Relation'',DateOfBirth = ''@DateOfBirth'', 
Age = ''@Age'',UpdatedBy = @UpdatedBy,  UpdatedOn = DATEADD(MINUTE, 330, GETUTCDATE())   where RegId =  @RegId  ', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (76, N'RegFamily', N'getRegFamily', N'select * from [PROD].[RegFamily] where RegId = @regid; 
', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (77, N'SP_ManualSwipes', N'upManualAtd', N'EXEC PROD.SP_ManualSwipes ''@data'',''@DaySwipes'' ', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (78, N'DayInOut', N'DayInOut', N'SELECT TOP 1 ID DayInOutId ,SuperId,RegId,DeptId,DateOfTransaction,InStatus,OutStatus,'''' Reason,ActualShiftId
FROM prod.DayInOut
WHERE SuperId = @superid
  AND RegId = @regid
  AND DateOfTransaction = ''@date''; ', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (79, N'DaySwipes', N'DaySwipes', N'SELECT ID DaySwipesId, InTime, OutTime
FROM prod.DaySwipes
WHERE SuperId = @superid
  AND RegId = @regid
  AND DateOfTransaction = ''@date'';', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (80, N'Type_RollCallReportFilter', N'getReports', N'DECLARE @Filter [PROD].[Type_RollCallReportFilter]
INSERT INTO @Filter (SuperId, ReportId, StartDate, EndDate, RegId, DeptId, AttendanceStatus, ShiftId, BranchId)
VALUES (@superid, @reportiid, @StartDate, @EndDate, @RegId, @DeptId, @AttendanceStatus, @ShiftId, @BranchId)
EXEC [PROD].[SP_RollCallGenerateReport] @Filter;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (81, N'prod.V_DayInOut', N'getDayInOutr', N'SELECT * FROM prod.V_DayInOutDetailsEMPManager
WHERE ManagerId = @ManagerId AND RegId = @regid
AND DateOfTransaction = ''@DateOfTransaction'';', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (82, N'AppReports', N'getreporthead', N'DECLARE @repid INT =@reportiid; -- example value
DECLARE @Filter NVARCHAR(MAX);
DECLARE @Datafreq INT;
DECLARE @Name NVARCHAR(200);
DECLARE @Description NVARCHAR(MAX);

-- Get the values from the table
SELECT  @Name = Name, @Description = Description,  @Filter = Filter, @Datafreq = Datafreq FROM [PROD].[AppReports] WHERE id = @repid;

-- Conditionally update the Filter
IF @Datafreq = 0
BEGIN
    SET @Filter = CONCAT(@Filter, '',StartDate,EndDate'');
END
ELSE IF @Datafreq = 1
BEGIN
    SET @Filter = CONCAT(@Filter, '',Month,Year'');
END
ELSE IF @Datafreq = 2
BEGIN
    SET @Filter = CONCAT(@Filter, '',Week'');
END
select @Name name,@Description Description,@Filter Filter

', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (83, N'LeaveTypes', N'creLeaveTypes', N'insert into Prod.LeaveTypes (lvtype,lvcode,isactive)
values(''@lvtype'',''@lvcode'',1)', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (84, N'LeaveTypes', N'upLeaveTypes', N'update Prod.LeaveTypes set lvtype = ''@lvtype'',lvcode = ''@lvcode'' where id = @id', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (85, N'LeaveTypes', N'delLeaveTypes', N'UPDATE Prod.LeaveTypes
SET IsActive = CASE 
    WHEN IsActive = 1 THEN 0
    ELSE 1
END
WHERE id = @id
 ', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (86, N'prod.V_Attendance', N'getAttebystatus', N'SELECT UserName, Department, CAST(InTime AS VARCHAR) AS InTime, Badge, FormatInTime, Mobile, MachineId, DateOfTransaction,
    FormatOutTime, InStatus, RegId, Duration, InStCode, OutStCode, WorkTime
	FROM prod.V_Attendance    
    WHERE SuperId = @SuperId AND  DateOfTransaction = ''@SelectedDate''  AND InStatus = ''@InStatus'';', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (87, N'dashboard', N'getdashbcount', N'SELECT
    (SELECT COUNT(*) 
     FROM [PROD].[Registration]
     WHERE SuperId = ''@SuperId'' AND IsActive = 1
    ) AS TOTALREGISTRATIONS,

    SUM(CASE WHEN InStatus = ''P''  THEN 1 ELSE 0 END) AS PRESENT,
    SUM(CASE WHEN InStatus = ''L''  THEN 1 ELSE 0 END) AS LATE,
    SUM(CASE WHEN InStatus = ''A''  THEN 1 ELSE 0 END) AS ABSENT,
    SUM(CASE WHEN InStatus = ''LV'' THEN 1 ELSE 0 END) AS LEAVE
FROM PROD.V_Attendance
WHERE SuperId = ''@SuperId''
  AND DateOfTransaction = ''@SelectedDate'';', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (88, N'V_LeaveAccruals', N'getaccuralsad', N'Select * from Prod.V_LeaveAccruals Where SuperId = @SuperId and Year = @Year', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (89, N'V_DayInOutDetailsEMPManager', N'getteamattforad', N'
Select * from [PROD].[V_DayInOutDetailsEMPAdmin]  Where Superid = @Superid and RegId = @regid 
and (DateOfTransaction >=   ''@startdate'' and DateOfTransaction <= ''@enddate'')', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (100, N'Branches', N'createbranch', N'  insert into [PROD].[Branches] (superid,name,code,CreatedBy,CreatedOn,IsActive)  
values(@superid,''@name'',''@code'',@createdby,DATEADD(MINUTE, 330, GETUTCDATE()),1)', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (101, N'Branches', N'updatebranch', N'UPDATE [PROD].[Branches]   SET name = ''@name'',code = ''@code'',UpdatedBy = @createdby,UpdatedOn = DATEADD(MINUTE, 330, GETUTCDATE())   WHERE id = @branchid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (102, N'Branches', N'deletebranch', N'UPDATE [PROD].[Branches]
 SET IsActive = 0,
     UpdatedOn = DATEADD(MINUTE, 330, GETUTCDATE())
 WHERE id = @branchid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (103, N'Branches', N'getbranches', N'SELECT id AS branchid,
        SuperId,
        Name,
        code
 FROM [PROD].[Branches]
 WHERE SuperId = @superid AND IsActive = 1', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (104, N'Shifts', N'getShiftsTypes', N'SELECT id AS shiftid,
        Name,
        CONVERT(varchar(8), StartTime, 108) AS StartTime,
        CONVERT(varchar(8), EndTime, 108) AS EndTime
 FROM [PROD].[Shifts]
 WHERE SuperId = @superid AND isactive = 1', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (105, N'EmpShift', N'assignshift', N'update  [PROD].[EmpShift] set isactive = 0 where RegId = @regid;

INSERT INTO [PROD].[EmpShift]    (RegId, ShiftId, StartDate, EndDate) 
VALUES   (@regid, @shiftid, ''@startdate'', ''@enddate'');', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (106, N'EmpShift', N'getAsgsftEmp', N'SELECT r.id AS regid,         r.Badge,         r.CardId,         r.UserName,         r.Designation,         es.ShiftId,         es.StartDate,        es.EndDate,         s.Name,         s.Code  ,DateOfJoining,Mobile,dept.name deptname  FROM [PROD].[EmpShift] es    INNER JOIN [PROD].[Registration] r ON r.id = es.RegId    INNER JOIN [PROD].[Shifts] s ON s.id = es.ShiftId    INNER JOIN PROD.EmpDept AS empd ON empd.RegId = r.Id   INNER JOIN PROD.Department AS dept ON dept.Id = empd.DeptId  WHERE   r.id = @regid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (107, N'V_PrevShiftEmp', N'getEmpByShift', N' 
SELECT  
    v.*, 
    reg.Designation, 
    dept.name AS Departmentname, 
    reg.id AS regid,
    shift.Name AS ShiftName
FROM prod.V_PrevShiftEmp AS v      
INNER JOIN [PROD].[Registration] reg ON reg.id = v.RegId    
INNER JOIN PROD.EmpDept AS empd ON empd.RegId = reg.Id
INNER JOIN PROD.Department AS dept ON dept.Id = empd.DeptId
INNER JOIN [PROD].[Shifts] AS shift ON shift.Id = v.ShiftId AND shift.SuperId = @superid
WHERE v.SuperId = @superid 
  AND v.ShiftId = @shiftid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (108, N'RegTermination', N'resignEmp', N'INSERT INTO [PROD].[RegTermination]
 (regid, TerminationDt, Reason, IsActive, UpdatedOn, UpdatedBy)
VALUES
 (@regid, ''@terminationdt'', ''@reason'', 1, DATEADD(MINUTE, 330, GETUTCDATE()), @createdby);
UPDATE [PROD].[Registration]
SET IsActive = 0
WHERE id = @regid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (109, N'Registration', N'rejoinEmp', N'UPDATE [PROD].[Registration]
 SET IsActive = 1
 WHERE id = @regid;
UPDATE [PROD].[RegTermination]
 SET IsActive = 0
 WHERE regid = @regid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (110, N'RegTermination', N'Terminatedlist', N'SELECT rt.regid,
        rt.TerminationDt,
        rt.Reason,
        rt.IsActive,
        rt.UpdatedOn,
        rt.UpdatedBy,
        r.Badge AS BIOMetricId,
        r.Designation,
        r.UserName
 FROM [PROD].[RegTermination] rt
 INNER JOIN [PROD].[Registration] r ON r.id = rt.RegId
 WHERE rt.IsActive = 1 AND r.superid = @superid
 ORDER BY rt.id DESC', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (111, N'Registration', N'addmobileAccess', N'UPDATE [PROD].[Registration]
 SET MobileAccess = 1
 WHERE id = @regid;
INSERT INTO [PROD].[RCEssentials] 
 (regid, SuperId, Badge, UserName, AccessType, AccessPwd)
SELECT id, SuperId, Badge, UserName, 1, ''123''
FROM [PROD].[Registration]
WHERE id = @regid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (112, N'Registration', N'adempprtalAces', N'UPDATE [PROD].[Registration]
 SET EmpPortalAccess = 1
 WHERE id = @regid;
INSERT INTO [PROD].[RCEssentials] 
 (regid, SuperId, Badge, UserName, AccessType, AccessPwd)
SELECT id, SuperId, Badge, UserName, 2, ''123''
FROM [PROD].[Registration]
WHERE id = @regid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (113, N'Registration', N'removemobAces', N'UPDATE [PROD].[Registration]
 SET MobileAccess = 0
 WHERE id = @regid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (114, N'Registration', N'rememppotalAces', N'UPDATE [PROD].[Registration]
 SET EmpPortalAccess = 0
 WHERE id = @regid', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (115, N'DayInOut', N'getShfCntByDate', N'SELECT COUNT(*) AS Count, DI.ActualShiftId, S.Name FROM PROD.DayInOut DI INNER JOIN PROD.Shifts S ON S.Id = DI.ActualShiftId WHERE DI.DateOfTransaction = ''@DateOfTransaction'' AND DI.SuperId = @SuperId GROUP BY DI.ActualShiftId, S.Name;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (116, N'V_Attendance', N'getlst7days', N'DECLARE @CurrentDate DATE = ''@currentdates'';
DECLARE @TotalRegistrations INT;
SELECT @TotalRegistrations = COUNT(*) FROM [PROD].[Registration]
WHERE SuperId = @SuperId AND IsActive = 1;
-- Generate last 7 days and aggregate attendance
SELECT
    @TotalRegistrations AS TOTALREGISTRATIONS,
    SUM(CASE WHEN A.InStatus = ''P''  THEN 1 ELSE 0 END) AS PRESENT,
    SUM(CASE WHEN A.InStatus = ''L''  THEN 1 ELSE 0 END) AS LATE,
    SUM(CASE WHEN A.InStatus = ''A''  THEN 1 ELSE 0 END) AS ABSENT,
    SUM(CASE WHEN A.InStatus = ''LV'' THEN 1 ELSE 0 END) AS LEAVE,
    D.TargetDate AS [Date]
FROM (
    SELECT DATEADD(DAY, -V.DayOffset, @CurrentDate) AS TargetDate
    FROM (VALUES (0),(1),(2),(3),(4),(5),(6)) V(DayOffset)
) D
LEFT JOIN PROD.V_Attendance A ON A.SuperId = @SuperId
   AND A.DateOfTransaction = D.TargetDate
GROUP BY D.TargetDate
ORDER BY D.TargetDate DESC;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (117, N'empfiles', N'insertImages', N'	BEGIN TRANSACTION;

-- Step 1: Deactivate existing records
UPDATE [dbo].[EmpFiles]
SET IsActive = 0,
    UpdateBy = @regid,
    UpdateOn = GETDATE()
WHERE SuperId = @superid
  AND RegId = @regid
  AND Type = ''@fileType''
  AND TypeName = ''@typename''
  AND IsActive = 1;

-- Step 2: Insert new active record
INSERT INTO [dbo].[EmpFiles]
    (SuperId, RegId, FilePath, Type, TypeName, IsActive, CreatedBy, CreatedOn, UpdateBy, UpdateOn)
VALUES
    (@superid, @regid, ''@filepath'', ''@fileType'', ''@typename'', 1, @regid, GETDATE(), NULL, NULL);

COMMIT TRANSACTION;

', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (118, N'empfiles', N'getfilepaths', N'	SELECT         Id,   FilePath,            Type AS FileType,            TypeName , CreatedOn     FROM [dbo].[EmpFiles]       WHERE SuperId = @superid AND RegId = @regid AND IsActive = 1
', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (119, N'empfiles', N'detelteimge', N'UPDATE [dbo].[EmpFiles]
SET IsActive = 0,
UpdateBy = @regid ,
UpdateOn = GETDATE()
WHERE Superid = @superid AND  Id= @ImageId AND Regid = @regid ;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (120, N'IsEmplManager', N'ismanager', N'select  [PROD].[func_IsEmplManager](@regid) AS IsManager', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (121, N'SP_BulkManualSwipes', N'createbulkatt', N'EXEC [dbo].[SP_BulkManualSwipes] @superid,@MachineId, ''@startdatetime'', ''@enddatetime'',''@regids''', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (122, N'EmailQueue', N'addqueuemail', N'Insert into dbo.EmailQueue(SuperId,ToAddress,Subject,Message,CreatedOn,CCEmail,isactive) 
values (@superid,''@ToAddress'',''@Subject'',''@Message'',GetDate(),''@CCEmail'',1);', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (123, N'V_MailQueue', N'bulkemail', N' select Top @reccnt * from dbo.V_MailQueue WHERE createdon >= DATEADD(HOUR, -24, GETDATE());', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (124, N'V_MailQueue', N'UPbulkemail', N'Update dbo.EmailQueue set IsProcessed = @IsProcessed,ResponseCode = @ResponseCode ,ResponseMsg = ''@ResponseMsg''  where Id = @EmailQueue', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (125, N'prod.Roles', N'getRoles', N'select id,rolename from prod.Roles where isactive=1', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (126, N'prod.modules', N'getModules', N'select id, modulename from [PROD].[Modules] where IsActive=1', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (127, N'prod.menu', N'getSubMenu', N'select id, MenuName from prod.menu where IsParent=1 and ParentMenuId=0 and IsActive=1', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (200, N'BOM', N'crtbomprdtinord', N'
-- Insert into [dbo].[BOM_BOM]
INSERT INTO [dbo].[BOM_BOM] (Name, Code, Description, Version, IsBuilt, IsActive, CreatedBy, CreatedOn)
VALUES (''@Name'', ''@Code'', ''@Description'', ''@Version'', @IsBuilt, 1, @CreatedBy, GETDATE());

-- Get newly inserted BOM Id
DECLARE @BOMId INT = SCOPE_IDENTITY();

-- Insert into BOM_ProductionOrder
INSERT INTO [dbo].[BOM_ProductionOrder] (BOMId, Qty, OEMPartNo, Status, OrderNo, Legend, IsActive, CreatedBy, CreatedOn)
VALUES (@BOMId, @Qty, ''@OEMPartNo'', ''@Status'', ''@OrderNo'', ''@Legend'', 1, @CreatedBy, GETDATE());
', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (201, N'BOM_BomItem', N'addbomitem', N'
INSERT INTO [dbo].[BOM_BomItem]
(BomId, Name, PartNo, CategoryId, Description, ShelfNo, RackNo, Stock, LowStockCount, UnitType, IsAssembled, IsBuilt, Location, Manufacturer, HSN, Price, IsActive, CreatedBy, CreatedOn)
VALUES
(@BOMId, ''@Name'', ''@PartNo'', @CategoryId, ''@Description'', ''@ShelfNo'', ''@RackNo'', @Stock, @LowStockCount, ''@UnitType'', @IsAssembled, @IsBuilt, ''@Location'', ''@Manufacturer'', ''@HSN'', @Price, 1, @createdby, DATEADD(MINUTE, 330, GETUTCDATE()));

INSERT INTO [dbo].[BOM_ProductionOrder]
(BOMId, ItemId, Qty, OEMPartNo, Status, OrderNo, Legend, IsActive, CreatedBy, CreatedOn)
VALUES
(@BOMId, SCOPE_IDENTITY(), @Qty, ''@OEMPartNo'', ''@Status'', ''@OrderNo'', ''@Legend'', 1, @createdby, DATEADD(MINUTE, 330, GETUTCDATE()));
', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (202, N'BOM_BomItem', N'getbomdata', N'
SELECT 
    i.Id AS ItemId,
    i.BOMId,
    i.Name,
    i.PartNo,
    i.CategoryId,
    i.Description,
    i.ShelfNo,
    i.RackNo,
    i.Stock,
    i.LowStockCount,
    i.UnitType,
    i.IsAssembled,
    i.IsBuilt,
    i.Location,
    i.Manufacturer,
    i.HSN,
    i.Price,
    p.Id AS ProductionOrderId,
    p.Qty,
    p.OEMPartNo,
    p.Status,
    p.OrderNo,
    p.Legend,
	p.IsActive,
	P.CreatedBy,
	p.CreatedOn,
	p.UpdatedOn,
	p.UpdatedBy
FROM  [dbo].[BOM_BomItem] i
LEFT JOIN [dbo].[BOM_ProductionOrder] p ON i.Id = p.ItemId AND p.IsActive = 1
WHERE i.BOMId = @BOMId AND i.IsActive = 1;
', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (203, N'BOM_BomItem', N'updateBomItem', N'UPDATE [dbo].[BOM_BomItem]
SET
    Name = CASE WHEN NULLIF(LTRIM(RTRIM(''@Name'')), '''') IS NULL THEN Name ELSE ''@Name'' END,
    PartNo = CASE WHEN NULLIF(LTRIM(RTRIM(''@PartNo'')), '''') IS NULL THEN PartNo ELSE ''@PartNo'' END,
    CategoryId = ISNULL(@CategoryId, CategoryId),
    Description = CASE WHEN NULLIF(LTRIM(RTRIM(''@Description'')), '''') IS NULL THEN Description ELSE ''@Description'' END,
    ShelfNo = CASE WHEN NULLIF(LTRIM(RTRIM(''@ShelfNo'')), '''') IS NULL THEN ShelfNo ELSE ''@ShelfNo'' END,
    RackNo = CASE WHEN NULLIF(LTRIM(RTRIM(''@RackNo'')), '''') IS NULL THEN RackNo ELSE ''@RackNo'' END,
    Stock = ISNULL(@Stock, Stock),
    LowStockCount = ISNULL(@LowStockCount, LowStockCount),
    UnitType = CASE WHEN NULLIF(LTRIM(RTRIM(''@UnitType'')), '''') IS NULL THEN UnitType ELSE ''@UnitType'' END,
    IsAssembled = ISNULL(@IsAssembled, IsAssembled),
    IsBuilt = ISNULL(@IsBuilt, IsBuilt),
    Location = CASE WHEN NULLIF(LTRIM(RTRIM(''@Location'')), '''') IS NULL THEN Location ELSE ''@Location'' END,
    Manufacturer = CASE WHEN NULLIF(LTRIM(RTRIM(''@Manufacturer'')), '''') IS NULL THEN Manufacturer ELSE ''@Manufacturer'' END,
    HSN = CASE WHEN NULLIF(LTRIM(RTRIM(''@HSN'')), '''') IS NULL THEN HSN ELSE ''@HSN'' END,
    Price = ISNULL(@Price, Price),
    UpdatedBy = @updatedby,
    UpdatedOn = DATEADD(MINUTE, 330, GETUTCDATE())
WHERE
    Id = @id AND BomId = @bomid;

UPDATE [dbo].[BOM_ProductionOrder]
SET
    Legend = CASE WHEN NULLIF(LTRIM(RTRIM(''@Legend'')), '''') IS NULL THEN Legend ELSE ''@Legend'' END,
    OrderNo = CASE WHEN NULLIF(LTRIM(RTRIM(''@OrderNo'')), '''') IS NULL THEN OrderNo ELSE ''@OrderNo'' END,
    Status = CASE WHEN NULLIF(LTRIM(RTRIM(''@Status'')), '''') IS NULL THEN Status ELSE ''@Status'' END,
    Qty = ISNULL(@Qty, Qty),
    OEMPartNo = CASE WHEN NULLIF(LTRIM(RTRIM(''@OEMPartNo'')), '''') IS NULL THEN OEMPartNo ELSE ''@OEMPartNo'' END,
    UpdatedBy = @updatedby,
    UpdatedOn = DATEADD(MINUTE, 330, GETUTCDATE())
WHERE
    ItemId = @id AND BOMId = @bomid;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (204, N'BOM_BomItem', N'deleteBomItem', N'UPDATE [dbo].[BOM_BomItem]
 SET IsActive = 0, UpdatedOn = DATEADD(MINUTE, 330, GETUTCDATE()), UpdatedBy = @UpdatedBy
 WHERE Id = @Id AND BomId = @BOMId;

UPDATE [dbo].[BOM_ProductionOrder]
 SET IsActive = 0, UpdatedOn = DATEADD(MINUTE, 330, GETUTCDATE()), UpdatedBy = @UpdatedBy
 WHERE BOMId = @BOMId AND ItemId = @Id;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (205, N'BOM', N'deleteBOM', N'
UPDATE [dbo].[BOM_BOM]
   SET IsActive = 0, UpdatedBy = @updatedby, UpdatedOn = DATEADD(MINUTE, 330, GETUTCDATE())
   WHERE Id = @Bomid;
   
   UPDATE [dbo].[BOM_ProductionOrder]
   SET IsActive = 0, UpdatedBy = @updatedby, UpdatedOn = DATEADD(MINUTE, 330, GETUTCDATE())
   WHERE BOMId = @Bomid;
', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (206, N'BOM', N'editBom', N'UPDATE [dbo].[BOM_BOM]
SET
    Name = CASE WHEN NULLIF(LTRIM(RTRIM(''@Name'')), '''') IS NULL THEN Name ELSE ''@Name'' END,
    Code = CASE WHEN NULLIF(LTRIM(RTRIM(''@Code'')), '''') IS NULL THEN Code ELSE ''@Code'' END,
    Description = CASE WHEN NULLIF(LTRIM(RTRIM(''@Description'')), '''') IS NULL THEN Description ELSE ''@Description'' END,
    Version = CASE WHEN NULLIF(LTRIM(RTRIM(''@Version'')), '''') IS NULL THEN Version ELSE ''@Version'' END,
    IsBuilt = ISNULL(@IsBuilt, IsBuilt),
    UpdatedBy = @updatedby,
    UpdatedOn = DATEADD(MINUTE, 330, GETUTCDATE())
WHERE
    Id = @id;

UPDATE [dbo].[BOM_ProductionOrder]
SET
    Legend = CASE WHEN NULLIF(LTRIM(RTRIM(''@Legend'')), '''') IS NULL THEN Legend ELSE ''@Legend'' END,
    OrderNo = CASE WHEN NULLIF(LTRIM(RTRIM(''@OrderNo'')), '''') IS NULL THEN OrderNo ELSE ''@OrderNo'' END,
    Status = CASE WHEN NULLIF(LTRIM(RTRIM(''@Status'')), '''') IS NULL THEN Status ELSE ''@Status'' END,
    Qty = ISNULL(@Qty, Qty),
    OEMPartNo = CASE WHEN NULLIF(LTRIM(RTRIM(''@OEMPartNo'')), '''') IS NULL THEN OEMPartNo ELSE ''@OEMPartNo'' END,
    UpdatedBy = @updatedby,
    UpdatedOn = DATEADD(MINUTE, 330, GETUTCDATE())
WHERE
    BOMId = @id;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (207, N'BOM', N'getBmItmPrdByQt', N'SELECT 
    b.Id AS BOM_Id,
    b.Name AS BOM_Name,
    bbi.Id AS BomItem_Id,
    bbi.Name AS BomItem_Name,
    bbi.PartNo,
    bbi.CategoryId,
    bbi.Description,
    bbi.ShelfNo,
    bbi.RackNo,
    bbi.Stock,
    bbi.LowStockCount,
    bbi.Location,
    bbi.UnitType,
    bbi.IsAssembled,
    bbi.IsBuilt,
    bbi.Manufacturer,
    bbi.HSN,
    bbi.Price,
    STRING_AGG(CAST(bpo.Id AS VARCHAR), '''') AS ProdOrderid,
    STRING_AGG(bpo.OEMPartNo, '''') AS OEMPartNo,
    STRING_AGG(bpo.OrderNo, '''') AS OrderNo,
    STRING_AGG(bpo.Status, '''') AS Status,
    STRING_AGG(bpo.Legend, '''') AS Legend,
    STRING_AGG(bpo.Qty, '''') AS Qty,
    STRING_AGG(CAST((bpo.Qty * q.Qtys) AS VARCHAR), '''') AS RequiredQty,
    bbi.CreatedOn,
    bbi.CreatedBy,
    bbi.UpdatedOn,
    bbi.UpdatedBy
FROM [dbo].[BOM_BOM] b
LEFT JOIN [dbo].[BOM_BomItem] bbi 
    ON b.Id = bbi.BomId AND bbi.IsActive = 1
LEFT JOIN [dbo].[BOM_ProductionOrder] bpo 
    ON b.Id = bpo.BOMId AND bpo.ItemId = bbi.Id AND bpo.IsActive = 1
CROSS JOIN (SELECT CAST(@Qyts AS INT) AS Qtys) q
WHERE b.Name = ''@Name'' AND b.IsActive = 1
GROUP BY 
    b.Id, b.Name,
    bbi.Id, bbi.Name, bbi.PartNo, bbi.CategoryId,
    bbi.Description, bbi.ShelfNo, bbi.RackNo,
    bbi.Stock, bbi.LowStockCount, bbi.Location,
    bbi.UnitType, bbi.IsAssembled, bbi.IsBuilt,
    bbi.Manufacturer, bbi.HSN, bbi.Price,
    bbi.CreatedOn, bbi.CreatedBy, bbi.UpdatedOn, bbi.UpdatedBy;
', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (208, N'BOM', N'getBOMinfo', N'SELECT 
        b.Id AS BOMId,
        b.Name,
        b.Code,
        b.Description,
        b.Version,
        b.IsBuilt,
        b.IsActive,
        b.CreatedBy,
        b.CreatedOn,
        b.UpdatedBy,
        b.UpdatedOn,
        p.Qty,
        p.OrderNo,
        p.OEMPartNo,
		p.Status,
	    p.Legend
     FROM 
        [dbo].[BOM_BOM] b
     LEFT JOIN 
        [dbo].[BOM_ProductionOrder] p ON b.Id = p.BOMId AND (p.IsActive = 1 AND p.ItemId IS NULL)
     WHERE 
        b.IsActive = 1;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (209, N'BOMitem', N'getBomIteminfo', N'SELECT 
        i.BOMId,
		i.Id AS ItemId,
        i.Name AS ItemName,
		i.CategoryId,
        i.PartNo,
        i.Stock,
		i.Description,
		i.ShelfNo,
		i.RackNo,
		i.LowStockCount,
		i.UnitType,
		i.IsAssembled,
		i.IsBuilt,
		i.Location,
		i.Manufacturer,
		i.HSN,
		i.Price,
		i.IsActive,
		i.CreatedBy,
		i.CreatedOn,
		i.UpdatedBy,
		i.UpdatedOn,
        p.Id AS ProductionOrderId,
        p.OrderNo,
        p.Qty,
        p.Status,
		p.OEMPartNo,
	    p.Legend
     FROM [dbo].[BOM_BomItem] i
     LEFT JOIN [dbo].[BOM_ProductionOrder] p 
        ON i.Id = p.ItemId AND p.IsActive = 1 AND p.BOMId = @bomId
     WHERE i.BOMId = @bomId AND i.Id = @itemId AND i.IsActive = 1;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (210, N'BOM_BomItem', N'getAllBomItems', N'SELECT 
        i.Id AS ItemId,
        i.BOMId,
        i.Name,
        i.PartNo,
        i.CategoryId,
        i.Description,
        i.ShelfNo,
        i.RackNo,
        i.Stock,
        i.LowStockCount,
        i.UnitType,
        i.IsAssembled,
        i.IsBuilt,
        i.Location,
        i.Manufacturer,
        i.HSN,
        i.Price,
        p.Qty,
        p.OrderNo,
        p.OEMPartNo,
	p.Legend,
	p.Status,
	p.CreatedBy,
	p.CreatedOn,
	p.UpdatedBy,
	p.UpdatedOn
    FROM [dbo].[BOM_BomItem] i
    LEFT JOIN [dbo].[BOM_ProductionOrder] p ON i.Id = p.ItemId AND p.IsActive = 1
    WHERE i.IsActive = 1;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (211, N'BOM', N'getBomInfoById', N'SELECT 
       b.Id AS BOMId,
        b.Name,
        b.Code,
        b.Description,
        b.Version,
        b.IsBuilt,
        b.IsActive,
        b.CreatedBy,
        b.CreatedOn,
        b.UpdatedBy,
        b.UpdatedOn,
        p.Qty,
        p.OrderNo,
        p.OEMPartNo,
		p.Status,
	    p.Legend
     FROM [dbo].[BOM_BOM] b
     LEFT JOIN [dbo].[BOM_ProductionOrder] p ON b.Id = p.BOMId AND (p.IsActive = 1 AND p.ItemId IS NULL)
     WHERE b.Id = @bomid AND b.IsActive = 1;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (212, N'BOMitem', N'chkavbtyofitm', N'SELECT 
        bbi.Id AS BomItem_Id,
        bbi.Name AS BomItem_Name,
        bbi.PartNo,
        bbi.CategoryId,
        bbi.Description,
        bbi.ShelfNo,
        bbi.RackNo,
        bbi.Stock,
        bbi.LowStockCount,
        bbi.Location,
        bbi.UnitType,
        bbi.IsAssembled,
        bbi.IsBuilt,
        bbi.Manufacturer,
        bbi.HSN,
        bbi.Price,
        bbi.BomId,

        STRING_AGG(CAST(bpo.Id AS VARCHAR), '''') AS ProdOrderId,
        STRING_AGG(bpo.OEMPartNo, '''') AS OEMPartNo,
        STRING_AGG(bpo.OrderNo, '''') AS OrderNo,
        STRING_AGG(bpo.Status, '''') AS Status,
        STRING_AGG(bpo.Legend, '''') AS Legend,
        STRING_AGG(CAST(bpo.Qty AS VARCHAR), '''') AS Qty,
        STRING_AGG(CAST((bpo.Qty * q.Qtys) AS VARCHAR), '''') AS RequiredQty,

        bbi.CreatedOn,
        bbi.CreatedBy,
        bbi.UpdatedOn,
        bbi.UpdatedBy

    FROM [dbo].[BOM_BomItem] bbi
    LEFT JOIN [dbo].[BOM_ProductionOrder] bpo 
        ON bbi.Id = bpo.ItemId 
        AND bbi.BomId = bpo.BOMId 
        AND bpo.IsActive = 1
    CROSS JOIN (SELECT CAST(@Qtys AS INT) AS Qtys) q

    WHERE bbi.Name = ''@ItemName'' AND bbi.IsActive = 1

    GROUP BY 
        bbi.Id, bbi.Name, bbi.PartNo, bbi.CategoryId,
        bbi.Description, bbi.ShelfNo, bbi.RackNo,
        bbi.Stock, bbi.LowStockCount, bbi.Location,
        bbi.UnitType, bbi.IsAssembled, bbi.IsBuilt,
        bbi.Manufacturer, bbi.HSN, bbi.Price,
        bbi.BomId,
        bbi.CreatedOn, bbi.CreatedBy, bbi.UpdatedOn, bbi.UpdatedBy;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (213, N'BOM', N'getActveBomCnt', N'SELECT COUNT(*) AS ActiveBOMCount FROM [dbo].[BOM_BOM] WHERE IsActive = 1;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (214, N'BOM_BomItem', N'getActItmCnt', N'SELECT COUNT(*) AS ActiveBOMItemCount FROM [dbo].[BOM_BomItem] WHERE IsActive = 1;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (215, N'BOM.BOMFiles', N'attachfile', N'INSERT INTO [dbo].[BOM_BOMFiles]
(RefId, RefType, FilePath, CreatedBy, CreatedOn, IsActive)
VALUES 
(@refid, ''@reftype'', ''@filepath'', @createdby, DATEADD(MINUTE, 330, GETUTCDATE()), 1);
', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (216, N'BOM.BOMFiles', N'getflepthbyref', N'SELECT FilePath
     FROM [dbo].[BOM_BOMFiles]
     WHERE RefId = @refid AND RefType = ''@reftype'' AND IsActive = 1;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (217, N'BOM', N'searchBOMByName', N'SELECT Name
     FROM [dbo].[BOM_BOM]
     WHERE IsActive = 1 AND Name LIKE ''%@Name%'' ;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (218, N'BOM.BOM_BomItem', N'searchbomitem', N'SELECT Name FROM [dbo].[BOM_BomItem] WHERE Name LIKE ''%@Name%'' AND IsActive = 1;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (219, N'Bom_Category', N'insrtCtgry', N'INSERT INTO [dbo].[Bom_Category] (
        Name,
        Description,
        MainCategoryId,
        IsActive,
        CreatedBy,
        CreatedOn
    ) VALUES (
        ''@Name'',
        ''@Description'',
        ''@MainCategoryId'',
        @IsActive,
        ''@CreatedBy'',
        GETDATE()
    );', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (220, N'Bom_Category', N'getAllCat', N'SELECT * FROM [dbo].[Bom_Category] WHERE IsActive = 1;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (221, N'Bom_Category', N'deleteCat', N'UPDATE [dbo].[Bom_Category]
     SET IsActive = 0,
	 UpdatedBy = ''@UpdatedBy''
     WHERE Id = @Id;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (222, N'Bom_Category', N'updateCat', N'UPDATE [dbo].[Bom_Category]
     SET
	    Name =  ISNULL(''@Name'', Name),
        Description = ISNULL(''@Description'', Description),
        MainCategoryId = ISNULL(@MainCategoryId, MainCategoryId),
        UpdatedBy = ''@UpdatedBy'',
        UpdatedOn = GETDATE()
     WHERE Id = @Id;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (223, N'RegEducation', N'createducation', N'INSERT INTO [PROD].[RegEducation]
     (SuperId, RegId, Qualification, College, University, Percentage, CreatedBy, CreatedOn, IsActive)
     VALUES
     (@SuperId, @RegId, ''@Qualification'', ''@College'', ''@University'', ''@Percentage'', ''@CreatedBy'', DATEADD(MINUTE, 330, GETUTCDATE()), 1);;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (224, N'RegEducation', N'updateeducation', N'UPDATE [PROD].[RegEducation]
     SET SuperId = COALESCE(NULLIF(@SuperId, ''''), SuperId),
	     RegId = COALESCE(NULLIF(@RegId, ''''), RegId),
         Qualification = COALESCE(NULLIF(''@Qualification'', ''''), Qualification),
         College = COALESCE(NULLIF(''@College'', ''''), College),
         University = COALESCE(NULLIF(''@University'', ''''), University),
         Percentage = COALESCE(NULLIF(''@Percentage'', ''''), Percentage),
         UpdatedBy = @UpdatedBy,
         UpdatedOn = DATEADD(MINUTE, 330, GETUTCDATE())
     WHERE Id = @EducationId;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (225, N'RegEducation', N'geteducat', N' SELECT *       FROM [PROD].[RegEducation]     
  WHERE RegId = @RegId            
  AND IsActive = 1;
 
', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (300, N'AllAssetTables', N'GETASSETSBYID', N'
SELECT
    A.Id AS AssetId,
    A.Code,
    A.Name,
    A.UnitsId,
    U.Name AS UnitName,
    AD.GroupId,
    AD.Quantity,
    AD.Status,
    AD.LastServiceDate,
    AD.NextServiceDate,
    AD.WarrantyPeriod,
    AD.UnitPrice,
    AP.DateOfPurchase,
    AD.ImageURL,
    H.AssignedTo,
    H.AssignedToEmployee,
    H.Location,
    H.StoreId,
    ST.Name AS StoreName,
    S.Id AS SupplierId,
    S.SupplierName,
    CONCAT(S.AddressLine1, '', '', S.AddressLine2, '' ,'', S.City, '' ,'', S.State, '', '', S.Country, '','', S.ZIPCode) AS SupplierAddress,
    S.PhoneNo AS SupplierPhone
FROM [dbo].[Assmgt_Asset] A
LEFT JOIN [dbo].[Assmgt_AssetDetails] AD ON A.Id = AD.AssetId
LEFT JOIN [dbo].[Assmgt_Units] U ON A.UnitsId = U.Id
LEFT JOIN [dbo].[Assmgt_AssetPurchases] AP ON A.Id = AP.AssetId
LEFT JOIN [dbo].[Assmgt_Supplier] S ON AD.SupplierId = S.Id AND S.IsActive = 1
OUTER APPLY (
    SELECT TOP 1 
        H.AssignedTo, 
        H.Location, 
        H.StoreId,
        U2.UserName AS AssignedToEmployee
    FROM [dbo].[Assmgt_AssetHistory] H
    LEFT JOIN [PROD].[Registration] U2 ON H.AssignedTo = U2.Id
    WHERE H.AssetId = A.Id
    ORDER BY H.CreatedOn DESC
) AS H
LEFT JOIN [PROD].[Department] ST ON H.StoreId = ST.Id
WHERE (@AssetId = 0 OR A.Id = @AssetId);
', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (301, N'AllAssetTables', N'AddAsset', N'
   DECLARE @NewAssetId INT;
    EXEC [PROD].[SP_AddFullAssetDetails]
   ''@Code'',''@Name'',@UnitsId,@GroupId, @Quantity,''@Status'', ''@LastServiceDate'',''@NextServiceDate'',@WarrantyPeriod,@UnitPrice,''@ImageURL'',''@Location '',@StoreId,
    @NewAssetId = @NewAssetId OUTPUT

	;
', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (302, N'Rolemenu', N'Getmenu', N';WITH HasRole AS (
    SELECT 
        CASE 
            WHEN EXISTS (
                SELECT 1 
                FROM PROD.OrgRoleMenu 
                WHERE RoleId = @RoleId
            ) THEN 1 ELSE 0 
        END AS HasData
),
MenuSource AS (
    SELECT v.*,
           CASE 
               WHEN v.SuperId = @SuperId THEN 1
               WHEN v.SuperId = 31113 THEN 2
               ELSE 3
           END AS Priority,
           h.HasData
    FROM PROD.V_ActiveMenuItems v
    CROSS JOIN HasRole h
    WHERE v.RoleId = @RoleId
      AND v.[Read] = 1
),
Dedup AS (
    SELECT *
    FROM (
        SELECT *,
               ROW_NUMBER() OVER (PARTITION BY Id ORDER BY Priority) AS rn
        FROM MenuSource
        WHERE 
            (HasData = 0 
             AND SuperId IN (@SuperId, 31113) 
             AND IsActive = 1)
            OR (HasData = 1)
    ) x
    WHERE rn = 1
)
SELECT *
FROM Dedup
ORDER BY SortOrder;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (303, N'Permissions', N'getPermissions', N'
DECLARE @menucount INT;
BEGIN
     SELECT @menucount = COUNT(id)
      FROM prod.menu 
      WHERE ParentMenuId IN (
          SELECT id FROM prod.menu WHERE (ParentMenuId = @subMenuItem)
      );
END
      IF @menucount = 0
      BEGIN

          ;WITH MenuSource AS (
              SELECT 
                  rm.RoleId, rm.menuid, rm.[Read], rm.[Write], rm.[Delete], 
                  rm.[Export], rm.SuperId, am.MenuName, am.path, am.fonticon, rm.id,
                  CASE 
                      WHEN rm.SuperId = @SuperItem THEN 1
                      WHEN rm.SuperId = 31113 THEN 2
                      ELSE 3
                  END AS Priority
              FROM prod.OrgRoleMenu rm
              INNER JOIN prod.menu am ON am.id = rm.menuid
              WHERE rm.RoleId = @RoleItem
                AND rm.IsActive = 1 
                AND am.IsActive = 1 
                AND rm.SuperId IN (31113, @SuperItem)
                AND am.ModuleId = @ModuleItem
                 AND (am.ParentMenuId = @subMenuItem or IsParent = 0)
          ),
          Dedup AS (
              SELECT *
              FROM (
                  SELECT *,
                      ROW_NUMBER() OVER(PARTITION BY menuid ORDER BY Priority) AS rn
                  FROM MenuSource
              ) x
              WHERE rn = 1
          )
          SELECT *
          FROM Dedup
          ORDER BY menuid;

      END
      ELSE
      BEGIN

          ;WITH MenuSource AS (
              SELECT 
                  rm.RoleId, rm.menuid, rm.[Read], rm.[Write], rm.[Delete], 
                  rm.[Export], rm.SuperId, am.MenuName, am.path, am.fonticon, rm.id,
                  CASE 
                      WHEN rm.SuperId = @SuperItem THEN 1
                      WHEN rm.SuperId = 31113 THEN 2
                      ELSE 3
                  END AS Priority
              FROM prod.OrgRoleMenu rm
              INNER JOIN prod.menu am ON am.id = rm.menuid
              WHERE rm.RoleId = @RoleItem
                AND rm.IsActive = 1 
                AND am.IsActive = 1 
                AND rm.SuperId IN (31113, @SuperItem)
                AND am.ModuleId = @ModuleItem
                AND am.ParentMenuId IN (
                      SELECT id FROM prod.menu WHERE ParentMenuId = @subMenuItem
                )
          ),
          Dedup AS (
              SELECT *
              FROM (
                  SELECT *,
                      ROW_NUMBER() OVER(PARTITION BY menuid ORDER BY Priority) AS rn
                  FROM MenuSource
              ) x
              WHERE rn = 1
          )
          SELECT *
          FROM Dedup
          ORDER BY menuid;

      END;', 1)
GO
INSERT [dbo].[ScreenOperations] ([Id], [TableName], [OpText], [SQLQuery], [IsActive]) VALUES (304, N'orgRoleMenu', N'updateRollNemu', N'BEGIN
      UPDATE prod.OrgRoleMenu
      SET [Read] = @read,
          [Write] = @write,
          [Delete] = @delete,
          [Export] = @export
      WHERE id = @updateId
        AND superid = @superId;

      -- Step 2: Insert a **copy** of updateId record IF it does not exist
      IF NOT EXISTS (
          SELECT 1 
          FROM prod.OrgRoleMenu 
          WHERE id = @updateId AND superid = @superId
      )
      BEGIN
          INSERT INTO prod.OrgRoleMenu
              (SuperId, RoleId, MenuId, [Read], [Write], [Delete], [Export], RemoveAccess, IsActive, CreatedBy)
          SELECT 
              @superId,       
              RoleId,             
              MenuId,            
              @read,
              @write,
              @delete,
              @export,
              RemoveAccess,
              IsActive,
              CreatedBy
          FROM prod.OrgRoleMenu
          WHERE id = @updateId;
      END
   END', 1)
GO
ALTER TABLE [dbo].[ScreenOperations] ADD  DEFAULT ((1)) FOR [IsActive]
GO
/****** Object:  StoredProcedure [PROD].[SP_ScreenOperations]    Script Date: 03/01/2026 12:22:24 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE PROCEDURE [PROD].[SP_ScreenOperations]
    @OperationId INT,
    @JsonData NVARCHAR(MAX),
    @ResultMessage NVARCHAR(MAX) OUTPUT,
    @STATUS NVARCHAR(MAX) OUTPUT 
AS
BEGIN
    DECLARE @FinalQuery NVARCHAR(MAX)
    DECLARE @ErrorMessage NVARCHAR(MAX)
    

    SET @ResultMessage = ''
    SET @STATUS = 'Success'


    SELECT @FinalQuery = SQLQuery FROM [ScreenOperations] WHERE Id = @OperationId

    PRINT @FinalQuery

    BEGIN TRY

        DECLARE @ParsedData TABLE (ColumnName NVARCHAR(255), ColumnValue NVARCHAR(MAX))

        INSERT INTO @ParsedData (ColumnName, ColumnValue)
        SELECT [key], [value]
        FROM OPENJSON(@JsonData)

        DECLARE @ColumnName NVARCHAR(255)
        DECLARE @ColumnValue NVARCHAR(MAX)

        DECLARE cursorData CURSOR FOR
        SELECT ColumnName, ColumnValue FROM @ParsedData

        OPEN cursorData
        FETCH NEXT FROM cursorData INTO @ColumnName, @ColumnValue

        WHILE @@FETCH_STATUS = 0
        BEGIN
            PRINT @ColumnName
            PRINT @ColumnValue


            SET @FinalQuery = REPLACE(@FinalQuery, '@' + @ColumnName, @ColumnValue)

            FETCH NEXT FROM cursorData INTO @ColumnName, @ColumnValue
        END

        CLOSE cursorData
        DEALLOCATE cursorData

        PRINT @FinalQuery


        EXEC sp_executesql @FinalQuery
        SET @ResultMessage = 'Query executed successfully.'
    END TRY
    BEGIN CATCH

        SET @ErrorMessage = ERROR_MESSAGE()
        SET @ResultMessage = 'Error executing query: ' + @ErrorMessage
        SET @STATUS = 'Failure'
    END CATCH
END
GO
